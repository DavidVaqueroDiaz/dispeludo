<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Dise√±o Peludo</title>
<style>
  *{box-sizing:border-box}
  body{font-family:sans-serif;margin:0;padding:20px;background:#fff8f0;text-align:center}
  .logo{max-width:180px;margin:10px auto}

  /* selector tama√±os */
  .selector{display:flex;justify-content:center;gap:10px;margin:20px 0}
  .selector img{width:80px;height:80px;object-fit:contain;border:2px solid #ccc;border-radius:8px;cursor:pointer;transition:.2s}
  .selector img.activo{border-color:#25d366}

  /* vista previa */
  #preview{position:relative;width:350px;height:350px;margin:0 auto;overflow:hidden}
  #preview img{width:100%;height:100%;object-fit:contain}

  #grabado{
    position:absolute;top:0;left:0;width:100%;height:100%;
    object-fit:contain;opacity:.7;pointer-events:none;display:none;
  }

  /* caja de info visible siempre */
  #info{
    width:350px;margin:8px auto 16px auto;
    background:#444;color:#fff;padding:6px;font-size:14px;border-radius:4px;
  }

  input,button{font-size:16px;padding:10px;border-radius:8px;border:1px solid #ccc;margin:8px auto;display:block;width:90%;max-width:350px}
  .btn{background:#25d366;color:#fff;border:none;font-weight:bold;cursor:pointer}
  .btn:hover{background:#1ebe5d}
  small{display:block;margin-top:10px;color:#555}
</style>
</head>
<body>

<img class="logo" src="Logo%20color.svg" alt="Logo Dise√±o Peludo">

<h2>Sube la foto de tu mascota y elige tama√±o</h2>

<div class="selector" id="selector">
  <img src="S.png"  data-size="S"  data-dim="√ò15 cm ¬∑ 6 cm alto"  data-price="20 ‚Ç¨" alt="Comedero S">
  <img src="M.png"  data-size="M"  data-dim="√ò18 cm ¬∑ 7 cm alto"  data-price="25 ‚Ç¨" alt="Comedero M">
  <img src="L.png"  data-size="L"  data-dim="√ò22 cm ¬∑ 8 cm alto"  data-price="30 ‚Ç¨" alt="Comedero L">
  <img src="XL.png" data-size="XL" data-dim="√ò26 cm ¬∑ 9 cm alto"  data-price="35 ‚Ç¨" alt="Comedero XL">
</div>

<div id="preview">
  <img id="cuencoBase" src="S.png" alt="Vista previa">
  <img id="grabado"   src=""    alt="">
</div>

<div id="info"></div>

<input type="file" id="foto" accept="image/*">

<button class="btn" id="btnIA">üß† Enviar imagen a IA</button>

<a class="btn" href="https://wa.me/34679285964?text=Hola%20quiero%20un%20comedero%20personalizado" target="_blank">
  üì± Escr√≠beme por WhatsApp
</a>

<h3>Datos para tramitar el pedido</h3>
<input id="nombre"  placeholder="Nombre completo">
<input id="telefono" placeholder="Tel√©fono (WhatsApp)">
<button class="btn" id="tramitar">üì¶ Tramitar pedido</button>

<small>Recibir√°s el dise√±o final tras confirmar el pedido.</small>

<script>
let selectedSize='S';
let fotoCargada=false;

const selector   = document.getElementById('selector');
const cuencoBase = document.getElementById('cuencoBase');
const grabado    = document.getElementById('grabado');
const infoBox    = document.getElementById('info');

/* --- selector de tama√±o --- */
selector.onclick = e=>{
 if(e.target.tagName!=='IMG') return;
 [...selector.children].forEach(img=>img.classList.remove('activo'));
 e.target.classList.add('activo');
 selectedSize   = e.target.dataset.size;
 cuencoBase.src = e.target.src;
 if(!fotoCargada) cuencoBase.style.display='block';  // solo si no hay foto
 infoBox.textContent = `${e.target.dataset.dim} ¬∑ ${e.target.dataset.price}`;
};

/* valor inicial */
selector.firstElementChild.classList.add('activo');
infoBox.textContent = '√ò15 cm ¬∑ 6 cm alto ¬∑ 20 ‚Ç¨';

/* --- subida de imagen --- */
document.getElementById('foto').onchange = e=>{
 const file = e.target.files[0];
 if(!file) return;
 const reader = new FileReader();
 reader.onload = ev=>{
   grabado.src = ev.target.result;
   grabado.style.display='block';
   cuencoBase.style.display='none';     // üî∏ ocultar cuenco base
   fotoCargada=true;
 };
 reader.readAsDataURL(file);
};

/* --- bot√≥n IA provisional --- */
document.getElementById('btnIA').onclick = ()=>{
 const file = document.getElementById('foto').files[0];
 if(!file) return alert('Sube una imagen primero');
 window.open('https://chatgpt.com/g/g-680d11d6dafc819199cd6a3cd71a87cb-ilustra-tu-mascota','_blank');
};

/* --- bot√≥n Tramitar pedido -> Netlify Function --- */
document.getElementById('tramitar').onclick = async ()=>{
  const nombre = document.getElementById('nombre').value.trim();
  const tel    = document.getElementById('telefono').value.trim();
  if(!nombre || !tel){
    alert('Rellena nombre y tel√©fono');
    return;
  }

  const body = { nombre, telefono: tel, size: selectedSize };

  try{
    const res = await fetch('/.netlify/functions/tramitar',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    if(res.ok){
      alert('¬°Pedido recibido! (demo funci√≥n)');
    }else{
      alert('Error al enviar pedido');
    }
  }catch(err){
    alert('Error de conexi√≥n');
  }
};
</script>

</body>
</html>
