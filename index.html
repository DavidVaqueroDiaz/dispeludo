<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Dise√±o Peludo</title>
<style>
  *{box-sizing:border-box}
  body{font-family:sans-serif;margin:0;padding:20px;background:#fff8f0;text-align:center}
  .logo{max-width:180px;margin:10px auto}

  .selector{display:flex;justify-content:center;gap:10px;margin:20px 0}
  .selector img{width:80px;height:80px;object-fit:contain;border:2px solid #ccc;border-radius:8px;cursor:pointer;transition:.2s}
  .selector img.activo{border-color:#25d366}

  #preview{position:relative;width:350px;height:350px;margin:0 auto;overflow:hidden}
  #preview img{width:100%;height:100%;object-fit:contain}
  #grabado{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain;opacity:.75;pointer-events:none;display:none}

  #info{width:350px;margin:8px auto 16px auto;background:#444;color:#fff;padding:6px;font-size:14px;border-radius:4px}

  details{max-width:350px;margin:20px auto;text-align:left;font-size:14px;border:1px solid #e0c485;border-radius:8px;background:#fff3d6}
  details[open]{box-shadow:0 2px 4px rgba(0,0,0,.15)}
  summary{padding:10px;cursor:pointer;font-weight:bold;outline:none}
  details div{padding:0 10px 10px}

  input,button{font-size:16px;padding:10px;border-radius:8px;border:1px solid #ccc;margin:8px auto;display:block;width:90%;max-width:350px}
  .btn{background:#25d366;color:#fff;border:none;font-weight:bold;cursor:pointer}
  .btn:hover{background:#1ebe5d}
  small{display:block;margin-top:10px;color:#555}
  label{font-weight:bold;margin-top:14px;display:block}
</style>
</head>
<body>

<img class="logo" src="Logo%20color.svg" alt="Logo Dise√±o Peludo">

<h2>Sube la foto de tu mascota y elige tama√±o</h2>

<div class="selector" id="selector">
  <img src="S.png"  data-size="S"  data-diam="11" data-price="12" alt="Comedero S">
  <img src="M.png"  data-size="M"  data-diam="16" data-price="14" alt="Comedero M">
  <img src="L.png"  data-size="L"  data-diam="19" data-price="15" alt="Comedero L">
  <img src="XL.png" data-size="XL" data-diam="22" data-price="17" alt="Comedero XL">
</div>

<div id="preview">
  <img id="cuencoBase" src="S.png" alt="Vista previa">
  <img id="grabado"   src=""    alt="">
</div>

<div id="info"></div>

<label>1Ô∏è‚É£ Foto original</label>
<input type="file" id="foto" accept="image/*">

<!-- ‚ñ∏ Gu√≠a desplegable -->
<details>
  <summary>üìã C√≥mo crear tu ilustraci√≥n con IA</summary>
  <div>
    1Ô∏è‚É£  Elige un <em>estilo</em> en ChatGPT:<br>
    &nbsp;&nbsp;‚Ä¢ <b>Minimalista</b> ‚Äì l√≠neas simples y claras.<br>
    &nbsp;&nbsp;‚Ä¢ <b>Detallado</b> ‚Äì m√°s sombras y texturas.<br>
    &nbsp;&nbsp;‚Ä¢ <b>Solo la cabeza</b> ‚Äì retrato de la cara.<br><br>
    2Ô∏è‚É£  Adjunta la foto de tu mascota dentro del chat.<br>
    3Ô∏è‚É£  Descarga la imagen <b>PNG o SVG</b> que genera.<br>
    4Ô∏è‚É£  Vuelve aqu√≠ y s√∫bela en <b>‚ÄúIlustraci√≥n generada por IA‚Äù</b>.
  </div>
</details>

<button class="btn" id="btnIA">üß† Generar dise√±o con IA</button>

<label>2Ô∏è‚É£ Ilustraci√≥n generada por IA (PNG/SVG)</label>
<input type="file" id="dise√±o" accept=".png,.svg,image/*">

<a class="btn" href="https://wa.me/34679285964?text=Hola%20quiero%20un%20comedero%20personalizado" target="_blank">
  üì± Escr√≠beme por WhatsApp
</a>

<h3>Datos para tramitar el pedido</h3>
<input id="nombre"  placeholder="Nombre completo">
<input id="telefono" placeholder="Tel√©fono (WhatsApp)">
<button class="btn" id="tramitar">üì¶ Tramitar pedido</button>

<small>Recibir√°s un correo con las dos im√°genes adjuntas para confirmar el pedido.</small>

<script>
/* ---------- variables ---------- */
let selectedSize = 'S';
let fotoCargada  = false;

const selector    = document.getElementById('selector');
const cuencoBase  = document.getElementById('cuencoBase');
const grabado     = document.getElementById('grabado');
const infoBox     = document.getElementById('info');
const fileInput   = document.getElementById('foto');
const designInput = document.getElementById('dise√±o');

/* ---------- selector de tama√±o ---------- */
selector.onclick = e=>{
  if(e.target.tagName !== 'IMG') return;
  [...selector.children].forEach(img=>img.classList.remove('activo'));
  e.target.classList.add('activo');
  selectedSize   = e.target.dataset.size;
  cuencoBase.src = e.target.src;
  if(!fotoCargada) cuencoBase.style.display='block';
  infoBox.textContent = `√ò${e.target.dataset.diam} cm ¬∑ ${e.target.dataset.price} ‚Ç¨`;
};

/* valor inicial */
selector.firstElementChild.classList.add('activo');
infoBox.textContent = '√ò11 cm ¬∑ 12 ‚Ç¨';

/* ---------- subida de foto original ---------- */
fileInput.onchange = e=>{
  const file = e.target.files[0];
  if(!file) return;
  const r = new FileReader();
  r.onload = ev=>{
    grabado.src = ev.target.result;
    grabado.style.display='block';
    cuencoBase.style.display='none';
    fotoCargada = true;
  };
  r.readAsDataURL(file);
};

/* ---------- bot√≥n IA ---------- */
document.getElementById('btnIA').onclick = ()=>{
  if(!fileInput.files.length){
    alert('Primero sube la foto original');
    return;
  }
  window.open(
    'https://chatgpt.com/g/g-680d11d6dafc819199cd6a3cd71a87cb-ilustra-tu-mascota',
    '_blank'
  );
};

/* ---------- bot√≥n Tramitar ---------- */
document.getElementById('tramitar').onclick = async ()=>{
  const nombre = document.getElementById('nombre').value.trim();
  const tel    = document.getElementById('telefono').value.trim();
  if(!nombre || !tel){
    alert('Rellena nombre y tel√©fono');
    return;
  }

  const toBase64 = f => new Promise(res=>{
    const r = new FileReader();
    r.onload = () => res(r.result.split(',')[1]);
    r.readAsDataURL(f);
  });

  const imageData  = fileInput.files.length  ? await toBase64(fileInput.files[0])  : null;
  const designData = designInput.files.length? await toBase64(designInput.files[0]): null;

  const body = { nombre, telefono: tel, size: selectedSize, imageData, designData };

  try{
    const r = await fetch('/.netlify/functions/tramitar',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    if(r.ok){
      alert('¬°Pedido recibido! Te contactaremos para confirmar.');
    }else{
      alert('Error al enviar pedido');
    }
  }catch(err){
    alert('Error de conexi√≥n');
  }
};
</script>

</body>
</html>
