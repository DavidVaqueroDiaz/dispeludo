<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Dise√±o Peludo</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#fff7f3;
  --card:#ffffff;
  --brand:#1ebe5d;
  --brand-dark:#13924a;
  --border:#e9ddd5;
  --shadow:0 6px 18px rgba(0,0,0,.08);
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Poppins',sans-serif;background:var(--bg);
  padding:30px 10px;min-height:100vh;color:#444;
}
h2,h3{font-weight:600;color:#222;margin-bottom:.3em}
img{display:block;max-width:100%}

.wrapper{
  display:grid;gap:32px;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  max-width:1300px;margin:0 auto;
}

/* -------- columna izquierda -------- */
.panel{
  background:var(--card);border:1px solid var(--border);
  border-radius:18px;padding:24px;box-shadow:var(--shadow)
}
#preview{position:relative;width:100%;padding-top:100%;overflow:hidden;border-radius:12px;margin-top:8px;border:1px solid var(--border)}
#preview img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain}
#grabado{opacity:.78;pointer-events:none;display:none}

/* -------- selector tama√±os -------- */
.selector{display:flex;justify-content:center;gap:14px;margin:18px 0}
.selector img{width:75px;height:75px;object-fit:contain;border:2px solid var(--border);border-radius:10px;cursor:pointer;transition:.25s}
.selector img:hover{transform:translateY(-3px)}
.selector img.activo{border-color:var(--brand)}

/* info barra */
#info{background:var(--brand-dark);color:#fff;font-weight:500;text-align:center;
  padding:6px 10px;border-radius:6px;margin:10px 0}

/* -------- m√≥dulo IA / chat -------- */
details{border:1px solid var(--border);border-radius:12px;background:#fff8e9;margin:14px 0}
summary{cursor:pointer;padding:12px;font-weight:600}
details[open]{box-shadow:var(--shadow)}
details div{padding:0 14px 16px;font-size:14px;line-height:1.35}

/* inputs & botones */
label{font-weight:600;margin-top:16px;display:block}
input[type=file],input[type=text],input[type=tel],button,.btn-link{
  width:100%;max-width:400px;font-size:15px;padding:11px 12px;border-radius:10px;
  border:1px solid var(--border);margin:10px auto
}
button.btn{background:var(--brand);color:#fff;border:none;font-weight:600;cursor:pointer;transition:.25s}
button.btn:hover{background:var(--brand-dark);transform:translateY(-2px)}
.btn-link{background:var(--brand);color:#fff;text-decoration:none;text-align:center;display:block}
small{display:block;text-align:center;font-size:13px;color:#777;margin-top:10px}

/* -------- ilustraci√≥n vector mini -------- */
.vector-box{border:1px solid var(--border);border-radius:10px;padding:14px;margin-top:18px;background:#fff}
.vector-box img{max-height:180px;margin:0 auto}

@media (min-width:900px){
  /* mantenemos proporci√≥n 4/6 para preview vs panel derecho */
  .wrapper{grid-template-columns:1.3fr .9fr}
}
</style>
</head>
<body>

<div class="wrapper">

  <!-- ----------  COLUMNA IZQUIERDA  ---------- -->
  <div class="panel">
    <h2>PREVISUALIZACI√ìN</h2>

    <div id="preview">
      <img id="cuencoBase" src="S.png" alt="Vista previa">
      <img id="grabado"   src=""    alt="">
    </div>

    <label style="margin-top:22px">1Ô∏è‚É£ Foto original</label>
    <input type="file" id="foto" accept="image/*">
  </div>

  <!-- ----------  COLUMNA DERECHA  ---------- -->
  <div class="panel">

    <!-- Selector -->
    <h2>ELIGE TU COMEDERO</h2>
    <div class="selector" id="selector">
      <img src="XL.png" data-size="XL" data-diam="22" data-price="17" alt="XL">
      <img src="L.png"  data-size="L"  data-diam="19" data-price="15" alt="L">
      <img src="M.png"  data-size="M"  data-diam="16" data-price="14" alt="M">
      <img src="S.png"  data-size="S"  data-diam="11" data-price="12" alt="S">
    </div>
    <div id="info"></div>

    <!-- Gu√≠a IA -->
    <details>
      <summary>üìã Gu√≠a para la ilustraci√≥n con IA</summary>
      <div>
        1Ô∏è‚É£ Elige un estilo en ChatGPT:<br>
        &nbsp;&nbsp;‚Ä¢ <b>Minimalista</b> &nbsp;‚Ä¢ <b>Detallado</b> &nbsp;‚Ä¢ <b>Solo la cabeza</b><br><br>
        2Ô∏è‚É£ Adjunta la foto de tu mascota en el chat.<br>
        3Ô∏è‚É£ Descarga la imagen <b>PNG o SVG</b>.<br>
        4Ô∏è‚É£ S√∫bela abajo en ‚ÄúIlustraci√≥n generada‚Äù.
      </div>
    </details>

    <button class="btn" id="btnIA">üß† Generar dise√±o con IA</button>

    <label>2Ô∏è‚É£ Ilustraci√≥n generada (PNG/SVG)</label>
    <input type="file" id="dise√±o" accept=".png,.svg,image/*">

    <div class="vector-box" id="vectorPreview" style="display:none">
      <img id="vectorImg" src="" alt="Vector Preview">
    </div>

    <a class="btn-link" href="https://wa.me/34679285964?text=Hola%20quiero%20un%20comedero%20personalizado" target="_blank">
      üì± Escr√≠beme por WhatsApp
    </a>

    <h3 style="margin-top:26px">Datos del pedido</h3>
    <input id="nombre"  placeholder="Nombre completo" type="text">
    <input id="telefono" placeholder="Tel√©fono (WhatsApp)" type="tel">
    <button class="btn" id="tramitar">üì¶ Tramitar pedido</button>

    <small>Te enviaremos un correo con ambas im√°genes para confirmar el dise√±o.</small>
  </div>
</div>

<script>
/* ---------- variables ---------- */
let selectedSize='S', fotoCargada=false;
const $=id=>document.getElementById(id);
const selector=$('selector'), cuencoBase=$('cuencoBase'), grabado=$('grabado');
const infoBox=$('info'), fileInput=$('foto'), designInput=$('dise√±o');
const vectorBox=$('vectorPreview'), vectorImg=$('vectorImg');

/* selector */
selector.onclick=e=>{
  if(e.target.tagName!=='IMG')return;
  [...selector.children].forEach(i=>i.classList.remove('activo'));
  e.target.classList.add('activo');
  selectedSize=e.target.dataset.size;
  cuencoBase.src=e.target.src;
  if(!fotoCargada)cuencoBase.style.display='block';
  infoBox.textContent=`√ò${e.target.dataset.diam} cm ¬∑ ${e.target.dataset.price} ‚Ç¨`;
};
selector.children[3].classList.add('activo'); // S inicial
infoBox.textContent='√ò11 cm ¬∑ 12 ‚Ç¨';

/* preview foto mascota */
fileInput.onchange=e=>{
  const f=e.target.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=ev=>{
    grabado.src=ev.target.result;grabado.style.display='block';
    cuencoBase.style.display='none';fotoCargada=true;
  };r.readAsDataURL(f);
};

/* preview vector IA */
designInput.onchange=e=>{
  const f=e.target.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=ev=>{
    vectorImg.src=ev.target.result;vectorBox.style.display='block';
  };r.readAsDataURL(f);
};

/* bot√≥n IA */
$('btnIA').onclick=()=>{
  if(!fileInput.files.length)return alert('Primero sube la foto original');
  window.open('https://chatgpt.com/g/g-680d11d6dafc819199cd6a3cd71a87cb-ilustra-tu-mascota','_blank');
};

/* tramitar */
$('tramitar').onclick=async()=>{
  const nombre=$('nombre').value.trim(), tel=$('telefono').value.trim();
  if(!nombre||!tel)return alert('Rellena nombre y tel√©fono');

  const toB64=f=>new Promise(r=>{const fr=new FileReader();fr.onload=()=>r(fr.result.split(',')[1]);fr.readAsDataURL(f);});
  const imageData=fileInput.files.length?await toB64(fileInput.files[0]):null;
  const designData=designInput.files.length?await toB64(designInput.files[0]):null;

  try{
    const res=await fetch('/.netlify/functions/tramitar',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({nombre,telefono:tel,size:selectedSize,imageData,designData})
    });
    res.ok?alert('¬°Pedido recibido!'):alert('Error al enviar');
  }catch{alert('Error de conexi√≥n');}
};
</script>

</body>
</html>
