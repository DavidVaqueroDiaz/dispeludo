<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>DiseÃ±o Peludo â€“ Personaliza tu comedero</title>
<style>
  :root{
    --bg:#fff2e9;
    --primary:#0ea960;
    --primary-dark:#0b864c;
    --border:#e0d6cf;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:sans-serif;
    background:var(--bg);
    padding:20px;
  }
  h2{font-size:1.3rem;margin-bottom:12px}
  .contenedor{
    max-width:1100px;margin:auto;display:flex;gap:32px;
  }
  @media(max-width:800px){
    .contenedor{flex-direction:column}
  }

  /* ---------- PrevisualizaciÃ³n ---------- */
  .preview-wrapper{
    flex:1;
    background:#fff;border:1px solid var(--border);
    border-radius:8px;padding:20px;
  }
  .preview-wrapper h3{font-size:1.25rem;margin-bottom:10px}
  #preview{
    position:relative;
    width:100%;
    padding-top:100%;           /* cuadrado fluido */
    border:1px solid var(--border);
    border-radius:8px;
    overflow:hidden;
  }
  #preview img{
    position:absolute;
    top:0;left:0;width:100%;height:100%;object-fit:contain;
  }

  /* ---------- Panel de selecciÃ³n ---------- */
  .panel{
    width:320px;max-width:100%;
    background:#fff;border:1px solid var(--border);
    border-radius:8px;padding:20px;
  }
  .cuencos{display:flex;justify-content:space-between;margin-bottom:12px}
  .cuencos img{
    width:60px;height:60px;object-fit:contain;
    border:2px solid var(--border);border-radius:6px;cursor:pointer;
    transition:.2s;
  }
  .cuencos img.activo{border-color:var(--primary)}
  #precio{
    background:var(--primary);
    color:#fff;font-weight:bold;
    border-radius:6px;
    text-align:center;
    padding:6px;margin-bottom:14px;
    font-size:.9rem;
  }

  /* ---------- Inputs & botones ---------- */
  input,button,details{
    font-size:.9rem;width:100%;
    border-radius:6px;border:1px solid var(--border);
    padding:10px;margin-bottom:12px;
  }
  input[type=file]{padding:8px}
  button{
    background:var(--primary);color:#fff;font-weight:bold;border:none;
    cursor:pointer;transition:.2s;
  }
  button:hover{background:var(--primary-dark)}
  details summary{cursor:pointer;font-weight:bold;color:#333;user-select:none}
  details[open]{background:#fff9f6}

  small{font-size:.8rem;color:#555}

</style>
</head>
<body>

<div class="contenedor">

  <!-- PrevisualizaciÃ³n -->
  <section class="preview-wrapper">
    <h3>PREVISUALIZACIÃ“N</h3>
    <div id="preview">
      <img id="demo"     src="gato.png" alt="">
      <img id="grabado"  src=""        alt="" style="display:none">
    </div>
  </section>

  <!-- Panel derecho -->
  <aside class="panel">
    <h2>ELIGE TU COMEDERO</h2>

    <!-- Cuencos -->
    <div class="cuencos" id="selector">
      <img src="S.png"  data-size="S"  data-dim="Ã˜11 cm" data-price="12 â‚¬" alt="S">
      <img src="M.png"  data-size="M"  data-dim="Ã˜16 cm" data-price="14 â‚¬" alt="M">
      <img src="L.png"  data-size="L"  data-dim="Ã˜19 cm" data-price="15 â‚¬" alt="L">
      <img src="XL.png" data-size="XL" data-dim="Ã˜22 cm" data-price="17 â‚¬" alt="XL">
    </div>

    <div id="precio">Ã˜11 cm Â· 12 â‚¬</div>

    <!-- 1 -->
    <label><b>1</b> Sube tu foto original
      <input type="file" id="foto" accept="image/*">
    </label>

    <!-- guÃ­a -->
    <details>
      <summary>ðŸ“‘ GuÃ­a para la ilustraciÃ³n con IA</summary>
      <p style="margin:10px 0 0 0;font-size:.85rem;line-height:1.4">
        Selecciona uno de los estilos de la lista (Minimalista, Detallado o Solo la cabeza) y sube tu foto.
        Descarga la ilustraciÃ³n resultante y sÃºbela en el paso&nbsp;2.<br>
        Â¡No olvides elegir bien el encuadre!
      </p>
    </details>

    <!-- BotÃ³n IA -->
    <button id="btnIA">ðŸ§  Generar diseÃ±o con IA</button>

    <!-- 2 -->
    <label><b>2</b> IlustraciÃ³n generada (PNG/SVG)
      <input type="file" id="dibujo" accept="image/*,image/svg+xml">
    </label>

    <!-- Datos -->
    <h3 style="margin-top:8px">Datos del pedido</h3>
    <input id="nombre"  placeholder="Nombre completo">
    <input id="telefono" placeholder="TelÃ©fono (WhatsApp)">

    <button id="tramitar">ðŸ“¦ Tramitar pedido</button>

    <p style="font-size:.8rem;margin-top:14px">
      Â¿Tienes alguna duda o no puedes hacer tu diseÃ±o?<br>
      EscrÃ­beme por WhatsApp y lo haremos nosotros.
    </p>
    <a href="https://wa.me/34679285964" target="_blank">
      <button style="margin-top:4px">ðŸ’¬ WhatsApp</button>
    </a>
  </aside>

</div>

<!-- -------------  JS  ------------- -->
<script>
/* Mapa de imagen-demo por talla */
const demoImg = {
  S : 'gato.png',
  M : 'perro pequeno.png',
  L : 'perro mediano.png',
  XL: 'perro grande.png'
};

/* Estado global */
let selectedSize = 'S';
let fotoCargada  = false;

const selector = document.getElementById('selector');
const demo     = document.getElementById('demo');
const grabado  = document.getElementById('grabado');
const precio   = document.getElementById('precio');

/* --- Selector de talla ------------------------------------ */
selector.onclick = e =>{
  if(e.target.tagName!=='IMG') return;

  /* resaltado */
  [...selector.children].forEach(img=>img.classList.remove('activo'));
  e.target.classList.add('activo');

  /* datos */
  selectedSize = e.target.dataset.size;
  precio.textContent = `${e.target.dataset.dim} Â· ${e.target.dataset.price}`;

  /* demo si aÃºn no hay foto */
  if(!fotoCargada){
    demo.src               = demoImg[selectedSize];
    demo.style.display     = 'block';
    grabado.style.display  = 'none';
  }
};

/* Marca inicial (S activo) */
selector.firstElementChild.classList.add('activo');

/* --- Foto original del cliente ---------------------------- */
document.getElementById('foto').onchange = e=>{
  const file = e.target.files[0];
  if(!file) return;
  const rdr = new FileReader();
  rdr.onload = ev=>{
    demo.style.display    = 'none';          // ocultamos demo
    grabado.src           = ev.target.result;
    grabado.style.display = 'block';
    fotoCargada           = true;
  };
  rdr.readAsDataURL(file);
};

/* --- BotÃ³n IA provisional (abre tu GPT) ------------------- */
document.getElementById('btnIA').onclick = ()=>{
  const file = document.getElementById('foto').files[0];
  if(!file) return alert('Sube tu foto original primero');
  window.open('https://chatgpt.com/g/g-680d11d6dafc819199cd6a3cd71a87cb-ilustra-tu-mascota','_blank');
};

/* --- BotÃ³n tramitar (sin cambios) ------------------------- */
document.getElementById('tramitar').onclick = async ()=>{
  const nombre = document.getElementById('nombre').value.trim();
  const tel    = document.getElementById('telefono').value.trim();
  if(!nombre || !tel){ alert('Rellena nombre y telÃ©fono'); return; }

  const body = { nombre, telefono:tel, size:selectedSize };
  try{
    const res = await fetch('/.netlify/functions/tramitar',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    if(res.ok){ alert('Â¡Pedido recibido!'); }
    else      { alert('Error al enviar pedido'); }
  }catch{ alert('Error de conexiÃ³n'); }
};
</script>

</body>
</html>
